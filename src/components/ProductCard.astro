---
import AddToQuoteBtn from './islands/AddToQuoteBtn.tsx';
import { slugify } from '../utils/slugify';
import { applicationTags } from '../data/application-tags';
import { getCategoryPlaceholderSvg } from '../utils/category-placeholders';

interface Props {
  sku: string;
  title: string;
  category: string;
  categorySlug: string;
  description: string;
  image: string | null;
  badge: string | null;
  inStock: boolean;
  delay?: number;
  hasVariants?: boolean;
}

const { sku, title, category, categorySlug, description, image, badge, inStock, delay, hasVariants } = Astro.props;
const productUrl = `/productos/${slugify(title)}`;
const tags = applicationTags[categorySlug] || [];
---

<article class="product-card" data-aos="fade-up" data-aos-delay={delay ? String(delay) : undefined}>
  <a href={productUrl} class="product-link">
    <div class="product-image">
      {badge && <span class:list={['product-badge', { 'badge-popular': badge === 'Popular', 'badge-pro': badge === 'Pro' }]}>{badge}</span>}
      {image ? (
        <img src={image} alt={title} loading="lazy" decoding="async" width="300" height="200" sizes="(max-width: 480px) calc(100vw - 32px), (max-width: 768px) calc(50vw - 24px), (max-width: 1024px) calc(33.33vw - 24px), 280px" />
      ) : (
        <Fragment set:html={getCategoryPlaceholderSvg(categorySlug)} />
      )}
    </div>
    <div class="product-content">
      <div class="product-meta-row">
        <span class="product-category">{category}</span>
        {hasVariants && (
          <span class="variant-indicator">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="11" height="11" aria-hidden="true">
              <rect x="3" y="3" width="7" height="7" rx="1"/>
              <rect x="14" y="3" width="7" height="7" rx="1"/>
              <rect x="3" y="14" width="7" height="7" rx="1"/>
              <rect x="14" y="14" width="7" height="7" rx="1"/>
            </svg>
            Variantes
          </span>
        )}
      </div>
      {tags.length > 0 && (
        <div class="application-tags">
          {tags.map((tag) => (
            <span class="app-tag">{tag}</span>
          ))}
        </div>
      )}
      <h3 class="product-title">{title}</h3>
      <p class="product-description">{description}</p>
      <div class="product-sku-row">
        <span class="product-sku">SKU: {sku}</span>
        <span class:list={['card-stock', { 'out-stock': !inStock }]}>
          <span class="stock-dot"></span>
          {inStock ? 'En Stock' : 'Sin Stock'}
        </span>
      </div>
    </div>
  </a>
  <div class="product-footer">
    <AddToQuoteBtn client:visible sku={sku} title={title} category={category} image={image} inStock={inStock} />
  </div>
</article>
